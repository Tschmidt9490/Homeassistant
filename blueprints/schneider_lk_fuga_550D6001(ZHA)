blueprint:
  name: Schneider Electric LG FUGA 550D6001 Ultimate (ZHA)
  description: Use the press/hold/release actions from all 4 buttons triggered by LK FUGA 550D6001 switch using ZHA.
  domain: automation
  author: Thomas Simonsen
  input:
    controller_device:
      name: (ZHA) Controller Device
      description: Select the controller device to use for the automation.
      selector:
        device:
          integration: zha
    light:
      name: Light(s)
      description: The light(s) to control
      selector:
        target:
          entity:
            domain: light
    hold_time:
      name: Hold Time
      description: Time between the execution of the brighter/darker actions when holding the brighter/darker button.
      default: 0.5
      selector:
        number:
          min: 0.1
          max: 2
          step: 0.1
          unit_of_measurement: seconds
    top_left_pressed:
      name: 1. Top Left Pressed
      default: []
      selector:
        action: {}
    top_right_pressed:
      name: 2. Top Right Pressed
      default: []
      selector:
        action: {}
    bottom_left_pressed:
      name: 3. Bottom Left Pressed
      default: []
      selector:
        action: {}
    bottom_left_held:
      name: 3. Bottom Left Held
      default: []
      selector:
        action: {}
    bottom_left_released:
      name: 3. Bottom Left Released
      default: []
      selector:
        action: {}
    bottom_right_pressed:
      name: 4. Bottom Right Pressed
      default: []
      selector:
        action: {}
    bottom_right_held:
      name: 4. Bottom Right Held
      default: []
      selector:
        action: {}
    bottom_right_released:
      name: 4. Bottom Right Released
      default: []
      selector:
        action: {}
  source_url: https://github.com/Tschmidt9490/homeassistant/blob/bf47ffb4967f02a164d6277ed1545b711711675a/blueprints/schneider_lk_fuga_550D6001(ZHA)
mode: single
max_exceeded: silent
trigger:
  - platform: event
    event_type: zha_event
    event_data:
      device_ieee: !input controller_device
action:
  - variables:
      command: "{{ trigger.event.data.command }}"
      args: "{{ trigger.event.data.args }}"
      endpoint_id: "{{ trigger.event.data.endpoint_id }}"
      cluster_id: "{{ trigger.event.data.cluster_id }}"
  - choose:
      # Top Left Button (On)
      - conditions:
          - condition: template
            value_template: "{{ command == 'on' and endpoint_id == 21 and cluster_id == 6 }}"
        sequence: !input top_left_pressed

      # Top Right Button (Off)
      - conditions:
          - condition: template
            value_template: "{{ command == 'off' and endpoint_id == 21 and cluster_id == 6 }}"
        sequence: !input top_right_pressed

      # Bottom Left Button (Increase Brightness)
      - conditions:
          - condition: template
            value_template: "{{ command == 'move' and endpoint_id == 22 and cluster_id == 8 and args[0] == 1 }}"
        sequence:
          - repeat:
              until:
                - condition: template
                  value_template: "{{ is_state_attr('zha_event', 'command', 'stop') and endpoint_id == 22 and cluster_id == 8 }}"
              sequence:
                - service: light.turn_on
                  target: !input light
                  data:
                    brightness_step_pct: 10
                    transition: !input hold_time
                - delay: !input hold_time

      # Bottom Right Button (Decrease Brightness)
      - conditions:
          - condition: template
            value_template: "{{ command == 'move' and endpoint_id == 22 and cluster_id == 8 and args[0] == 1 }}"
        sequence:
          - repeat:
              until:
                - condition: template
                  value_template: "{{ is_state_attr('zha_event', 'command', 'stop') and endpoint_id == 22 and cluster_id == 8 }}"
              sequence:
                - service: light.turn_on
                  target: !input light
                  data:
                    brightness_step_pct: -10
                    transition: !input hold_time
                - delay: !input hold_time
